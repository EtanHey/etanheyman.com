"use strict";(globalThis.webpackChunk_golems_docsite=globalThis.webpackChunk_golems_docsite||[]).push([[5033],{4101(e,s,l){l.r(s),l.d(s,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"packages/shared","title":"@golems/shared \u2014 Foundation Library","description":"Supabase ORM, LLM abstraction, email processing, Whoop client, state management, and notifications for all golem packages.","source":"@site/docs/packages/shared.md","sourceDirName":"packages","slug":"/packages/shared","permalink":"/golems/docs/packages/shared","draft":false,"unlisted":false,"editUrl":"https://github.com/EtanHey/golems/tree/master/packages/docs/docs/packages/shared.md","tags":[],"version":"current","frontMatter":{"title":"@golems/shared \u2014 Foundation Library","description":"Supabase ORM, LLM abstraction, email processing, Whoop client, state management, and notifications for all golem packages."},"sidebar":"mainSidebar","previous":{"title":"Services \u2014 Infrastructure Layer","permalink":"/golems/docs/packages/services"},"next":{"title":"Zikaron \u2014 Memory Layer","permalink":"/golems/docs/packages/zikaron"}}');var r=l(4848),i=l(8453);const t={title:"@golems/shared \u2014 Foundation Library",description:"Supabase ORM, LLM abstraction, email processing, Whoop client, state management, and notifications for all golem packages."},d="@golems/shared",a={},c=[{value:"What It Does",id:"what-it-does",level:2},{value:"Key Modules",id:"key-modules",level:2},{value:"Whoop Client",id:"whoop-client",level:2},{value:"Email Infrastructure",id:"email-infrastructure",level:2},{value:"Email MCP Tools",id:"email-mcp-tools",level:3},{value:"LLM Abstraction",id:"llm-abstraction",level:2},{value:"Free Cloud LLM (Vercel AI SDK)",id:"free-cloud-llm-vercel-ai-sdk",level:3},{value:"State Management",id:"state-management",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Source",id:"source",level:2}];function o(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"golemsshared",children:"@golems/shared"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"Foundation library that every golem depends on. Supabase, LLM, email, Whoop, state, notifications, and shared types."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"what-it-does",children:"What It Does"}),"\n",(0,r.jsxs)(s.p,{children:["Shared is the ",(0,r.jsx)(s.strong,{children:"infrastructure layer"})," of the Golems ecosystem. It provides database access, multi-backend LLM calls, email processing, Whoop biometric client, state management, and Telegram notifications. No golem-specific logic lives here \u2014 only reusable utilities that all packages import."]}),"\n",(0,r.jsx)(s.h2,{id:"key-modules",children:"Key Modules"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Module"}),(0,r.jsx)(s.th,{children:"Import"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"supabase-factory"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/supabase-factory"})}),(0,r.jsx)(s.td,{children:"Singleton Supabase client creation"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"llm"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/llm"})}),(0,r.jsx)(s.td,{children:"Multi-backend LLM runner (Haiku, Ollama, GLM)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"vercel-llm"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/vercel-llm"})}),(0,r.jsx)(s.td,{children:"Free cloud LLM (Gemini Flash-Lite, Groq)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"glm-llm"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/glm-llm"})}),(0,r.jsx)(s.td,{children:"Local GLM-4.7-Flash via Ollama HTTP"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"telegram-direct"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/telegram-direct"})}),(0,r.jsx)(s.td,{children:"Dual-mode notifications (localhost:3847 or Bot API)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"state-store"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/state-store"})}),(0,r.jsx)(s.td,{children:"File/Supabase state abstraction"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"event-log"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/event-log"})}),(0,r.jsx)(s.td,{children:'Action logging ("while you were down" context)'})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"load-env"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/load-env"})}),(0,r.jsx)(s.td,{children:".env loader for launchd (must be first import)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"cost-tracker"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/cost-tracker"})}),(0,r.jsx)(s.td,{children:"API cost logging (JSONL)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"config"})}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"@golems/shared/lib/config"})}),(0,r.jsx)(s.td,{children:"Centralized config paths"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"whoop-client",children:"Whoop Client"}),"\n",(0,r.jsxs)(s.p,{children:["The Whoop subsystem lives in ",(0,r.jsx)(s.code,{children:"@golems/shared/whoop/"})," and provides biometric data access:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Client"})," (",(0,r.jsx)(s.code,{children:"whoop/client.ts"}),") \u2014 OAuth2 token refresh + API v2 calls"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Types"})," (",(0,r.jsx)(s.code,{children:"whoop/types.ts"}),") \u2014 ",(0,r.jsx)(s.code,{children:"WhoopRecovery"}),", ",(0,r.jsx)(s.code,{children:"WhoopSleep"}),", ",(0,r.jsx)(s.code,{children:"WhoopStrain"})," interfaces"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Sync"})," (",(0,r.jsx)(s.code,{children:"whoop/sync.ts"}),") \u2014 ",(0,r.jsx)(s.code,{children:"syncWhoopToSupabase()"})," for dashboard caching"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'import { getLatestRecovery, getLatestSleep, getTodayStrain } from "@golems/shared/whoop/client";\n\nconst recovery = await getLatestRecovery(); // { score, hrv, restingHR, spo2, ... }\nconst sleep = await getLatestSleep();       // { duration, rem, deep, light, ... }\nconst strain = await getTodayStrain();      // { strain, kilojoule, avgHR, maxHR }\n'})}),"\n",(0,r.jsx)(s.h2,{id:"email-infrastructure",children:"Email Infrastructure"}),"\n",(0,r.jsxs)(s.p,{children:["The email subsystem lives in ",(0,r.jsx)(s.code,{children:"@golems/shared/email/"})," and provides the full Gmail pipeline:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Gmail client"})," \u2014 OAuth2-based Gmail API access"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Scorer"})," \u2014 LLM-powered email scoring (1-10 urgency)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Router"})," \u2014 Routes scored emails to the appropriate domain golem"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Draft replies"})," \u2014 Template-based reply generation"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Follow-up tracking"})," \u2014 Due date management for pending responses"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"MCP server"})," \u2014 7 email tools exposed to Claude Code"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"email-mcp-tools",children:"Email MCP Tools"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Tool"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"email_getRecent"})}),(0,r.jsx)(s.td,{children:"Recent emails by hours + minimum score"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"email_search"})}),(0,r.jsx)(s.td,{children:"Keyword search in subject/sender"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"email_subscriptions"})}),(0,r.jsx)(s.td,{children:"Monthly subscription summary"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"email_urgent"})}),(0,r.jsx)(s.td,{children:"Unnotified urgent emails"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"email_stats"})}),(0,r.jsx)(s.td,{children:"24h category breakdown"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"email_getByGolem"})}),(0,r.jsx)(s.td,{children:"Emails routed to a specific golem"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"email_draftReply"})}),(0,r.jsx)(s.td,{children:"Generate reply draft by intent"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"llm-abstraction",children:"LLM Abstraction"}),"\n",(0,r.jsx)(s.p,{children:"Switch between backends with a single env var:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"LLM_BACKEND=haiku    # Cloud: Anthropic Haiku via API\nLLM_BACKEND=ollama   # Local: Ollama on your Mac\nLLM_BACKEND=glm      # Local: GLM-4.7-Flash via Ollama HTTP\nLLM_BACKEND=gemini   # Cloud: Gemini 2.5 Flash-Lite (free)\nLLM_BACKEND=groq     # Cloud: Llama 4 Scout (free)\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'import { runLLMJSON, runLLMText } from "@golems/shared/lib/llm";\n\n// Works identically regardless of backend\nconst result = await runLLMJSON({ prompt: "Categorize this email", schema: emailSchema });\n'})}),"\n",(0,r.jsx)(s.h3,{id:"free-cloud-llm-vercel-ai-sdk",children:"Free Cloud LLM (Vercel AI SDK)"}),"\n",(0,r.jsx)(s.p,{children:"For services that need free cloud LLM without API keys (e.g., CoachGolem coaching engine):"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'import { runCloudFree, runCloudFreeJSON } from "@golems/shared/lib/vercel-llm";\n\nconst advice = await runCloudFree({ prompt: "Generate daily coaching advice", maxTokens: 500 });\n'})}),"\n",(0,r.jsx)(s.p,{children:"Supports Gemini Flash-Lite and Groq with auto-fallback on 429 rate limits."}),"\n",(0,r.jsx)(s.h2,{id:"state-management",children:"State Management"}),"\n",(0,r.jsx)(s.p,{children:"Dual-backend state storage:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"STATE_BACKEND=supabase   # Cloud: Supabase database\nSTATE_BACKEND=file       # Local: ~/.golems-zikaron/\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'import { getState, setState } from "@golems/shared/lib/state-store";\n\nconst nightTarget = await getState("nightShiftTarget");\nawait setState("nightShiftTarget", "songscript");\n'})}),"\n",(0,r.jsx)(s.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"@supabase/supabase-js"})," \u2014 Database client"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"googleapis"})," \u2014 Gmail API"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"@ai-sdk/google"})," + ",(0,r.jsx)(s.code,{children:"@ai-sdk/groq"})," \u2014 Vercel AI SDK for free cloud LLM"]}),"\n",(0,r.jsx)(s.li,{children:"No internal @golems/* dependencies (shared is the root)"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"source",children:"Source"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/EtanHey/golems/tree/master/packages/shared",children:(0,r.jsx)(s.code,{children:"packages/shared/"})})})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,s,l){l.d(s,{R:()=>t,x:()=>d});var n=l(6540);const r={},i=n.createContext(r);function t(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);