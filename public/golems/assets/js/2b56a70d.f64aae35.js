"use strict";(globalThis.webpackChunk_golems_docsite=globalThis.webpackChunk_golems_docsite||[]).push([[9898],{3137(e,n,l){l.r(n),l.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"golems/email","title":"Email System \u2014 Infrastructure","description":"Gmail polling, LLM scoring, domain routing, reply drafting, and follow-up tracking.","source":"@site/docs/golems/email.md","sourceDirName":"golems","slug":"/golems/email","permalink":"/golems/docs/golems/email","draft":false,"unlisted":false,"editUrl":"https://github.com/EtanHey/golems/tree/master/packages/docs/docs/golems/email.md","tags":[],"version":"current","frontMatter":{"title":"Email System \u2014 Infrastructure","description":"Gmail polling, LLM scoring, domain routing, reply drafting, and follow-up tracking."},"sidebar":"mainSidebar","previous":{"title":"CoachGolem \u2014 Health-Aware Life Coach","permalink":"/golems/docs/golems/coach"},"next":{"title":"JobGolem \u2014 Job Discovery","permalink":"/golems/docs/golems/job-golem"}}');var i=l(4848),r=l(8453);const t={title:"Email System \u2014 Infrastructure",description:"Gmail polling, LLM scoring, domain routing, reply drafting, and follow-up tracking."},o="Email System (Infrastructure)",a={},d=[{value:"Core Pipeline",id:"core-pipeline",level:2},{value:"Scoring System (1-10)",id:"scoring-system-1-10",level:3},{value:"Email Routing",id:"email-routing",level:3},{value:"Files",id:"files",level:2},{value:"Key Features",id:"key-features",level:2},{value:"Reply Drafting",id:"reply-drafting",level:3},{value:"Follow-up Tracking",id:"follow-up-tracking",level:3},{value:"MCP Tools",id:"mcp-tools",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Database Schema",id:"database-schema",level:2},{value:"Running the Email System",id:"running-the-email-system",level:2},{value:"Integration with Other Golems",id:"integration-with-other-golems",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"email-system-infrastructure",children:"Email System (Infrastructure)"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," The email subsystem was dissolved into ",(0,i.jsx)(n.code,{children:"@golems/shared"})," during Phase 8 componentization. It's infrastructure \u2014 not a standalone golem. The email system lives in ",(0,i.jsx)(n.code,{children:"packages/shared/src/email/"})," and provides scoring, routing, and MCP tools that all golems can use."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The email system is the intake layer for all external communication. It polls Gmail on a schedule (hourly 6am-7pm in cloud with 12pm lunch skip and 10pm check, or every 10 minutes via local launchd), scores emails for urgency, routes them to domain experts, and manages reply drafting and follow-ups."}),"\n",(0,i.jsx)(n.h2,{id:"core-pipeline",children:"Core Pipeline"}),"\n",(0,i.jsx)(n.mermaid,{value:"flowchart LR\n    A[Gmail] --\x3e B[OAuth2 Poll<br/>hourly / 10min] --\x3e C[Scoring<br/>Haiku LLM] --\x3e D[Routing] --\x3e E[Domain Golems]\n    D --\x3e F[Follow-up Tracking]\n    F --\x3e G[Reply Drafting]"}),"\n",(0,i.jsx)(n.h3,{id:"scoring-system-1-10",children:"Scoring System (1-10)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"10"})," \u2014 Instant Telegram alert (respond now)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"7-9"})," \u2014 Morning briefing (check at 8am)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"5-6"})," \u2014 Monthly tracking (archive, but revisit montly)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"1-4"})," \u2014 Ignore (auto-archive)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Scoring is done via Ollama by default (or Haiku when ",(0,i.jsx)(n.code,{children:"LLM_BACKEND=haiku"}),") analyzing subject, sender, and body context."]}),"\n",(0,i.jsx)(n.h3,{id:"email-routing",children:"Email Routing"}),"\n",(0,i.jsx)(n.p,{children:"Routes emails to domain golems based on content patterns:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Email Type"}),(0,i.jsx)(n.th,{children:"Router"}),(0,i.jsx)(n.th,{children:"GolemActor"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Job offers, interview requests"}),(0,i.jsx)(n.td,{children:"Contact pattern + keywords"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"recruitergolem"})}),(0,i.jsx)(n.td,{children:"Outreach DB updated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Subscription/billing"}),(0,i.jsxs)(n.td,{children:["Domain ",(0,i.jsx)(n.code,{children:"@stripe.com"}),", ",(0,i.jsx)(n.code,{children:"@paddle.com"}),", etc"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"tellergolem"})}),(0,i.jsx)(n.td,{children:"Expense categorization, payment alerts, reports"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Tech updates, urgent notifications"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"[urgent]"})," tag, mention of code/PR"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"claudegolem"})}),(0,i.jsx)(n.td,{children:"Fast-track to ClaudeGolem"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"General"}),(0,i.jsx)(n.td,{children:"Fallback"}),(0,i.jsx)(n.td,{children:"EmailGolem queue"}),(0,i.jsxs)(n.td,{children:["Score determines visibility, queryable via ",(0,i.jsx)(n.code,{children:"email_getByGolem"})]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"files",children:"Files"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Core Engine"})," (in ",(0,i.jsx)(n.code,{children:"packages/shared/src/email/"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"index.ts"})," \u2014 Main entry point, Gmail client initialization"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"gmail-client.ts"})," \u2014 OAuth2 auth, polling logic"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scorer.ts"})," \u2014 Ollama/Haiku scoring pipeline (no caching)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"db-client.ts"})," \u2014 Supabase adapter with offline queue"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"mcp-server.ts"})," \u2014 MCP server (7 email tools + 2 teller tools)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"types.ts"})," \u2014 TypeScript interfaces"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Routing & Processing:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"router.ts"})," \u2014 Domain golem routing logic"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"draft-reply.ts"})," \u2014 Template-based reply generation with intents"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"followup.ts"})," \u2014 Follow-up scheduling and tracking"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,i.jsx)(n.h3,{id:"reply-drafting",children:"Reply Drafting"}),"\n",(0,i.jsx)(n.p,{children:"Auto-generate email replies with preset intents:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// draft-reply.ts\nconst intents = [\n  'accept',      // Yes, I'm interested\n  'decline',     // No thanks\n  'interested',  // Tell me more\n  'followup',    // When can we talk?\n  'acknowledge'  // Received, will review\n];\n"})}),"\n",(0,i.jsx)(n.p,{children:"Drafts are stored in the database and can be reviewed before sending via Telegram."}),"\n",(0,i.jsx)(n.h3,{id:"follow-up-tracking",children:"Follow-up Tracking"}),"\n",(0,i.jsx)(n.p,{children:"Category-based due dates:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Category"}),(0,i.jsx)(n.th,{children:"Due Date"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Interview"}),(0,i.jsx)(n.td,{children:"3 days"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Job"}),(0,i.jsx)(n.td,{children:"5 days"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Urgent"}),(0,i.jsx)(n.td,{children:"1 day"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Tech-update"}),(0,i.jsx)(n.td,{children:"7 days"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Other"}),(0,i.jsx)(n.td,{children:"7 days"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Follow-ups trigger alerts if not completed by due date."}),"\n",(0,i.jsx)(n.h2,{id:"mcp-tools",children:"MCP Tools"}),"\n",(0,i.jsxs)(n.p,{children:["Available via the ",(0,i.jsx)(n.code,{children:"golems-email"})," MCP server (",(0,i.jsx)(n.code,{children:"packages/shared/src/email/mcp-server.ts"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"email_getRecent"})})," \u2014 Fetch last N emails from inbox"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"email_search"})})," \u2014 Search emails by keyword (subject/sender, last 7 days only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"email_subscriptions"})})," \u2014 Get subscription/billing emails (Stripe, Paddle, etc)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"email_urgent"})})," \u2014 Get emails flagged as urgent"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"email_stats"})})," \u2014 Summary: total, by score, by routing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"email_getByGolem"})})," \u2014 Fetch emails routed to a specific golem"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"email_draftReply"})})," \u2014 Generate reply draft for an email"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# 1Password items (store in any vault)\nexport GMAIL_REFRESH_TOKEN=$(op read op://YOUR_VAULT/YOUR_GMAIL_ITEM/refresh_token)\nexport ANTHROPIC_API_KEY=$(op read op://YOUR_VAULT/YOUR_ANTHROPIC_ITEM/credential)\nexport SUPABASE_SERVICE_KEY=$(op read op://YOUR_VAULT/YOUR_SUPABASE_ITEM/service_key)\n\n# Scoring model (Phase 2+)\nexport LLM_BACKEND=haiku  # or 'ollama' (default)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Emails table\nCREATE TABLE emails (\n  id TEXT PRIMARY KEY,\n  from_address TEXT,\n  subject TEXT,\n  body TEXT,\n  score INTEGER (1-10),\n  routing_golem TEXT,\n  created_at TIMESTAMP,\n  routed_at TIMESTAMP,\n  follow_up_due_at TIMESTAMP\n);\n\n-- Subscriptions table (for TellerGolem)\nCREATE TABLE subscriptions (\n  id TEXT PRIMARY KEY,\n  vendor TEXT,\n  amount NUMERIC,\n  category TEXT,\n  created_at TIMESTAMP\n);\n\n-- Payments table (for TellerGolem)\nCREATE TABLE payments (\n  id TEXT PRIMARY KEY,\n  vendor TEXT,\n  amount NUMERIC,\n  category TEXT,\n  payment_date TIMESTAMP\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"running-the-email-system",children:"Running the Email System"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Manually trigger poll cycle (normally runs every 10min)\nbun packages/shared/src/email/index.ts\n\n# Or use the CLI\ngolems email --triage\n"})}),"\n",(0,i.jsx)(n.h2,{id:"integration-with-other-golems",children:"Integration with Other Golems"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RecruiterGolem"})," \u2014 Job emails trigger outreach DB updates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TellerGolem"})," \u2014 Subscription emails routed for expense categorization, payment alerts, and reports"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ClaudeGolem"})," \u2014 Urgent emails fast-tracked to code/PR context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Telegram Bot"})," \u2014 High-score (10) emails sent as instant alerts"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Emails not being scored:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check LLM backend is running (Ollama or Haiku)\necho $LLM_BACKEND\n\n# Check Gmail OAuth token\nop read op://YOUR_VAULT/YOUR_GMAIL_ITEM/refresh_token\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Routing to wrong golem:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Review routing patterns in router.ts\n# Router invokes handlers for each golem type (Recruiter, Teller, Claude)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Follow-ups not triggering:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check launchd job (runs via cron or launchd)\nlaunchctl list | grep golems-email\ncat ~/Library/LaunchAgents/golems-email.plist\n"})}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.code,{children:"/docs/configuration/env-vars.md"})," for Gmail OAuth setup."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,n,l){l.d(n,{R:()=>t,x:()=>o});var s=l(6540);const i={},r=s.createContext(i);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);